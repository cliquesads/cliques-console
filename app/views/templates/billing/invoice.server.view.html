<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>Cliques Billing</title>

    <style>
        .invoice-box{
            max-width:800px;
            margin:auto;
            padding:30px;
            border:1px solid #eee;
            box-shadow:0 0 10px rgba(0, 0, 0, .15);
            font-size:16px;
            line-height:24px;
            font-family:'Avenir', sans-serif;
            color:#555;
        }

        .invoice-box table{
            width:100%;
            line-height:inherit;
            text-align:left;
        }

        .invoice-box table td{
            padding:5px;
            vertical-align:top;
        }

        .invoice-box table tr.metadata td:nth-child(2){
            text-align:right;
        }

        .invoice-box table tr td:nth-child(4){
            text-align:right;
        }

        .invoice-box table tr.top table td{
            padding-bottom:20px;
        }

        .invoice-box table tr.top table td.title{
            font-size:45px;
            line-height:45px;
            color:#333;
        }

        .invoice-box table tr.information table td{
            padding-bottom:40px;
        }

        .invoice-box table tr.heading td{
            background:#eee;
            border-bottom:1px solid #ddd;
            font-weight:bold;
        }

        .invoice-box table tr.subdivider td{
            background:#F5F5F5;
            /*border-bottom:1px solid #ddd;*/
            font-style: italic;
        }

        .invoice-box table tr.beginning-balance td{
            padding-bottom: 20px;
        }

        .invoice-box table tr.details td{
            padding-bottom:20px;
        }

        .invoice-box table tr.item td{
            border-bottom:1px solid #eee;
        }

        .invoice-box table tr.item.last td{
            border-bottom:none;
        }

        .invoice-box table tr.subtotal td:nth-child(3){
            border-top:2px solid #eee;
            padding-bottom: 20px;
        }

        .invoice-box table tr.subtotal td:nth-child(4){
            border-top:2px solid #eee;
            padding-bottom: 20px;
        }

        .invoice-box table tr.total td{
            padding-bottom: 40px;
        }

        .invoice-box table tr.total td:nth-child(3){
            border-top:3px solid #eee;
            font-weight:bold;
        }

        .invoice-box table tr.total td:nth-child(4){
            border-top:3px solid #eee;
            font-weight:bold;
        }

        @media only screen and (max-width: 600px) {
            .invoice-box table tr.top table td{
                width:100%;
                display:block;
                text-align:center;
            }

            .invoice-box table tr.information table td{
                width:100%;
                display:block;
                text-align:center;
            }
        }

        .footer {
            text-align: center;
            font-size: 15px;
            font-style: italic;
        }
    </style>
</head>

<body>
<div class="invoice-box">
    <table cellpadding="0" cellspacing="0">
        <tr class="top metadata">
            <td colspan="4">
                <table>
                    <tr>
                        <td class="title">
                            <img src="https://storage.googleapis.com/cliquesads-logos/full-logo-green-Q-600.png" style="width:100%; max-width:300px;">
                        </td>
                        <td>
                            Invoice #: {{ payment._id }}<br>
                            Created: {{ payment.tstamp|date('F jS\, Y') }}<br>
                            Due: {{ payment.dueDate|date('F jS\, Y')  }}
                        </td>
                    </tr>
                </table>
            </td>
        </tr>

        <tr class="information metadata">
            <td colspan="4">
                <table>
                    <tr>
                        <td>
                            Cliques Labs Inc.<br>
                            172 Green St., Unit 9<br>
                            Boston, MA 02130 <br>
                            <br>
                            <em>Questions?<br>
                            <a href="mailto:support@cliquesads.com">support@cliquesads.com</a></em>
                        </td>
                        <td>
                            {{ payment.organization.name }}<br>
                            {{ payment.organization.address }}<br>
                            {% if payment.organization.address2 %}{{ payment.organization.address2 }}<br>{% endif %}
                            {{ payment.organization.city }}, {{ payment.organization.state }} {{ payment.organization.zip }} {{ payment.organization.country }}<br>
                            <br>
                            {{ payment.organization.owner.email }}<br>
                            {{ payment.organization.phone }}<br>
                        </td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr class="heading">
            <td>Type</td>
            <td>Description</td>
            <td>Rate</td>
            <td>Amount</td>
        </tr>
        <!--Get sign based on type of payment being made.  Negative if publisher because publisher payments are recorded as negative in Payments collection.-->
        {% set sign = (payment.paymentType == "advertiser") ? 1 : -1 %}
        <tr class="beginning-balance">
            <td></td>
            <td>Beginning Account Balance</td>
            <td></td>
            <td>{{ (payment.organization.accountBalance - payment.totalAmount) | round(2) | currency('$')}}</td>
        </tr>
        <tr class="subdivider">
            <td colspan="4">
                <em>Billing Period of {{ payment.start_date|date('F jS\, Y')}} - {{ payment.end_date|date('F jS\, Y') }}</em>
            </td>
        </tr>
        {% for li in payment.lineItems %}
        <tr class="item">
            <td>
                {{ li.lineItemType }}
            </td>
            <td>
                {{ li.description }}
            </td>
            <td>
                {% if li.lineItemType == 'Fee' || li.lineItemType == 'RevShare' %}
                    {{ li.rate|percent(2)}}
                {% else %}
                    {{ li.rate|round(2)|currency('$')}}
                {% endif %}
            </td>
            <td>
                {{ li.amount|round(2)|currency('$') }}
            </td>
        </tr>
        {% endfor %}
        {% for adj in payment.adjustments %}
        <tr class="item">
            <td>
                Adjustment
            </td>
            <td>
                {{ adj.description }}
            </td>
            <td></td>
            <td>
                {{ adj.amount|round(2)|currency('$') }}
            </td>
        </tr>
        {% endfor %}
        <tr class="subtotal">
            <td></td>
            <td></td>
            <td>Subtotal</td>
            <td>
                {{ payment.totalAmount|round(2)|currency('$')}}
            </td>
        </tr>
        <tr class="total">
            <td></td>
            <td></td>
            <td>Total</td>
            <td>
                {{ payment.organization.accountBalance|round(2)|currency('$')}}
            </td>
        </tr>

        <tr class="heading">
            <td>Payment Method</td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        {% if payment.organization.billingPreference == "Stripe" %}
            {% set cardLogos = {
                "Visa": "visa.svg",
                "American Express": "amex.svg",
                "MasterCard": "mastercard.svg",
                "Discover": "discover.svg",
                "JCB": "jcb.svg",
                "Diners Club": "diners.svg"
        } %}
            <tr class="details">
                <td>
                    <img style="vertical-align: middle" src="https://storage.googleapis.com/cliquesads-billing/invoice-images/stripe2.svg" height="40px" width="40px">
                    <span style="vertical-align: sub">&nbsp;{{ payment.organization.billingPreference }}</span>
                </td>
                {% if stripeSource.object == "card" %}
                    <td></td>
                    <td>
                        <img style="vertical-align: middle" src="https://storage.googleapis.com/cliquesads-billing/invoice-images/{{ cardLogos[stripeSource.brand] }}" height="40px" width="40px">
                        <span style="vertical-align: sub">&nbsp;{{ stripeSource.brand }}</span>
                    </td>
                    <td>xxxx-xxxx-xxxx-{{ stripeSource.last4 }}</td>
                {% elseif stripeSource.object == "bank_account" %}
                    <td></td>
                    <td>
                        <img style="vertical-align: middle" src="https://storage.googleapis.com/cliquesads-billing/invoice-images/bank-2.svg" height="40px" width="40px">
                        <span style="vertical-align: sub">&nbsp;{{ stripeSource.bank_name }}</span>
                    </td>
                    <td>xxxxxxxxxxx{{ stripeSource.last4 }}</td>
                {% endif %}
            </tr>
            <tr class="instructions">
                <td colspan="4">
                    Instructions: Your total balance above will be charged
                </td>
            </tr>
        {% elseif payment.organization.billingPreference == "Check" %}
            <tr class="details">
                <td>
                    <img style="vertical-align: middle" src="https://storage.googleapis.com/cliquesads-billing/invoice-images/icon-check-100.svg" height="40px" width="40px">
                    {{ payment.organization.billingPreference }}
                </td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr class="instructions">
                <td colspan="4">
                    <!--FILL IN-->
                </td>
            </tr>
        {% else %}
            <tr class="details">
                <td>{{ payment.organization.billingPreference }}</td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        {% endif %}
    </table>
    <p class="footer">
        To manage your billing preferences, please visit your <a href="https://console.cliquesads.com/#!/settings/billing">account settings page.</a>
    </p>
</div>
</body>
</html>